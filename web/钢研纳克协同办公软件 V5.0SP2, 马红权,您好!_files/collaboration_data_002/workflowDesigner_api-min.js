var wfAjax=new WFAjax();var workfowFlashDialog=null;function canTakeBack(C,H,G,D,B,A,E){try{return wfAjax.canTakeBack(A,H,G,C)}catch(F){alert(F.message)}}function canRepeal(A,D,C){try{return wfAjax.canRepeal(A,D,C)}catch(B){alert(B.message)}}function canStepBack(B,G,F,A,C,D){try{D=D==undefined?"":D;C=C==undefined?"":C;return wfAjax.canStepBack(B,A,G,F,C,D)}catch(E){alert(E.message)}}function canTemporaryPending(A){try{return wfAjax.canTemporaryPending(A)}catch(B){alert(B.message)}}function canSubmitWorkFlow(A){if(null!=A&&A!=""&&A!="-1"){return wfAjax.canWorkflowCurrentNodeSubmit(A)}return null}function lockWorkflow(D,A,B){try{return wfAjax.lockWorkflow(D,A,B)}catch(C){alert(C.message)}}function releaseWorkflow(C,A){try{return wfAjax.releaseWorkflow(C,A)}catch(B){alert(B.message)}}function releaseWorkflowByAction(D,A,B){try{return wfAjax.releaseWorkflow(D,A,B)}catch(C){alert(C.message)}}function checkWorkflowLock(C,A){try{return wfAjax.checkWorkflowLock(C,A)}catch(B){alert(B.message)}}function createWFTemplate(L,M,D,K,A,J,O,B,R,C,G,Q,F,P,H){var E=L;if(J){E=J}if(workfowFlashDialog){workfowFlashDialog.isHide=false;workfowFlashDialog.close()}var N=$(L).width();var I=$(L).height();workfowFlashDialog=$.dialog({isHide:true,url:_wfctxPath+"/workflow/designer.do?method=showDiagram&isDebugger=false&scene=0&isModalDialog=true&formApp="+D+"&formName="+K+"&appName="+M+"&processId="+A+"&currentUserId="+B+"&currentUserName="+encodeURIComponent(R)+"&currentUserAccountName="+encodeURIComponent(C)+"&defaultPolicyId="+O+"&defaultPolicyName="+encodeURIComponent(P)+"&flowPermAccountId="+G+"&operationName="+Q+"&startOperationName="+F+"&wendanId="+(H||"-1")+"&isvalidate=false",width:N-20,height:I-100,title:$.i18n("workflow.designer.title"),targetWindow:L,transParams:{subProcessJson:$("#process_subsetting",E.document).val(),formId:$("#formId").val(),dwidths:N,dheights:I-20,workflowRule:$("#process_rulecontent",E.document).val(),returnValueWindow:E},closeParam:{show:true,handler:function(){if(typeof recoverWorkFlowHistoryData=="function"){recoverWorkFlowHistoryData()}}},minParam:{show:false},maxParam:{show:false},buttons:[{text:$.i18n("workflow.designer.page.button.ok"),handler:function(){var S=workfowFlashDialog.getReturnValue({innerButtonId:"ok"});if(S){initDialogDataToParentPage(S,E,L);if(!$.browser.msie){workfowFlashDialog.close()}else{workfowFlashDialog.hideDialog()}if(typeof finishWorkFlowModify=="function"){finishWorkFlowModify()}}}},{text:$.i18n("workflow.designer.page.button.cancel"),handler:function(){if(!$.browser.msie){workfowFlashDialog.close()}else{workfowFlashDialog.hideDialog()}if(typeof recoverWorkFlowHistoryData=="function"){recoverWorkFlowHistoryData()}}}]})}function cloneWFTemplate(N,O,F,M,A,L,Q,B,U,D,J,T,I,R,C,E){var S=wfAjax.selectProcessTemplateXMLForClone(O,A,F,C||"-1",E||"-1","{}");if(S==null||S.length<2){$.alert("\u514b\u9686\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u8981\u514b\u9686\u7684\u6a21\u7248\uff01");return }var H=N;if(L){H=L}if(workfowFlashDialog){workfowFlashDialog.isHide=false;workfowFlashDialog.close()}var G=$("#process_xml",H.document).val();$("#process_xml",H.document).val(S[0]);var P=$(N).width();var K=$(N).height();workfowFlashDialog=$.dialog({isHide:true,url:_wfctxPath+"/workflow/designer.do?method=showDiagram&isDebugger=false&scene=0&isModalDialog=true&formApp="+F+"&formName="+M+"&appName="+O+"&processId=&currentUserId="+B+"&currentUserName="+encodeURIComponent(U)+"&currentUserAccountName="+encodeURIComponent(D)+"&defaultPolicyId="+Q+"&defaultPolicyName="+encodeURIComponent(R)+"&flowPermAccountId="+J+"&operationName="+T+"&startOperationName="+I+"&wendanId="+(E||"-1")+"&isvalidate=false",width:P-20,height:K-100,title:$.i18n("workflow.designer.title"),targetWindow:N,transParams:{subProcessJson:$("#process_subsetting",H.document).val(),formId:$("#formId").val(),dwidths:P,dheights:K-20,workflowRule:$("#process_rulecontent",H.document).val(),returnValueWindow:H,verifyResultXml:S[1]},closeParam:{show:true,handler:function(){$("#process_xml",H.document).val(G);if(typeof recoverWorkFlowHistoryData=="function"){recoverWorkFlowHistoryData()}}},minParam:{show:false},maxParam:{show:false},buttons:[{text:$.i18n("workflow.designer.page.button.ok"),handler:function(){var V=workfowFlashDialog.getReturnValue({innerButtonId:"ok"});if(V){var X=wfAjax.validateFormTemplate(O,F,V[1],V[4]);if(X==null||X.length<2){$.alert("\u6821\u9a8c\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u70b9\u51fb\u786e\u5b9a\u6309\u94ae\uff01");return }if("false"==X[0]){var Z=$($.parseXML(X[1].substr(38)));var e=Z.find("n[s=false]");var W=true,g="";if(e.size()>0){loopFlag1:for(var b=0,c=e.size();b<c;b++){var Y=e.eq(b);for(var a=0;a<3;a++){if("false"==Y.find("r"+a).text()){W=false;g=Y.find("r"+a+"msg").text();break loopFlag1}}}}var f=Z.find("l[s=false]");if(W&&f.size()>0){loopFlag2:for(var b=0,c=f.size();b<c;b++){var d=f.eq(b);if("false"==d.find("r0").text()){W=false;g=d.find("r0msg").text();break loopFlag2}}}Z=e=f=Y=d=null;if(!W){$.alert(g);return }}initDialogDataToParentPage(V,H,N);if(!$.browser.msie){workfowFlashDialog.close()}else{workfowFlashDialog.hideDialog()}if(typeof finishWorkFlowModify=="function"){finishWorkFlowModify()}}}},{text:$.i18n("workflow.designer.page.button.cancel"),handler:function(){$("#process_xml",H.document).val(G);if(!$.browser.msie){workfowFlashDialog.close()}else{workfowFlashDialog.hideDialog()}if(typeof recoverWorkFlowHistoryData=="function"){recoverWorkFlowHistoryData()}}}]})}function initDialogDataToParentPage(S,F,P){var B=S[0];var E=S[1];var M=S[2];var R=S[3];var D=S[4];var J=$("#process_desc_by",F.document)[0];var G=$("#process_xml",F.document)[0];var A=$("#process_info",F.document)[0];var L=$("#process_rulecontent",F.document)[0];var N=$("#process_subsetting",F.document)[0];if(!J&&B){showFlashAlert("Error: not found process_desc_by input element in parent page!");throw new Error("Error: not found process_desc_by input element in parent page!")}if(!G&&E){showFlashAlert("Error: not found process_xml input element in parent page!");throw new Error("Error: not found process_xml input element in parent page!")}if(!A&&M){showFlashAlert("Error: not found process_info input element in parent page!");throw new Error("Error: not found process_info input element in parent page!")}if(!L&&R){alert("Error: not found process_rulecontent input element in parent page!");throw new Error("Error: not found process_rulecontent input element in parent page!")}if(!N&&D){showFlashAlert("Error: not found process_subsetting input element in parent page!");throw new Error("Error: not found process_subsetting input element in parent page!")}if(B){J.value=B}if(E){G.value=E}if(M){A.value=M;$(A).trigger("propertychange").trigger("input")}try{L.value=(R==undefined||R==null)?"":R}catch(Q){}if(D){N.value=D}try{var C=$("#process_desc_by",P.document)[0];var O=$("#process_xml",P.document)[0];var K=$("#process_info",P.document)[0];var H=$("#process_rulecontent",P.document)[0];var I=$("#process_subsetting",P.document)[0];C.value=B;O.value=E;K.value=M;H.value=R;I.value=D}catch(Q){}}function createWFPersonal(L,H,E,G,D,B,J,F,I,A){var M=L;if(J){M=J}if(workfowFlashDialog){workfowFlashDialog.isHide=false;workfowFlashDialog.close()}var K=$(getCtpTop()).width();var C=$(getCtpTop()).height();workfowFlashDialog=$.dialog({isHide:true,url:_wfctxPath+"/workflow/designer.do?method=showDiagram&isDebugger=false&scene=1&isModalDialog=true&processId="+B+"&appName="+H+"&currentUserId="+E+"&currentUserName="+encodeURIComponent(G)+"&currentUserAccountName="+encodeURIComponent(D)+"&defaultPolicyId="+F+"&defaultPolicyName="+encodeURIComponent(A)+"&flowPermAccountId="+I,width:K-20,height:C-100,title:$.i18n("workflow.designer.title"),targetWindow:getCtpTop(),transParams:{dwidths:K,dheights:C,returnValueWindow:M},minParam:{show:false},maxParam:{show:false},buttons:[{text:$.i18n("workflow.designer.page.button.ok"),handler:function(){var N=workfowFlashDialog.getReturnValue({innerButtonId:"ok"});if(N){initDialogDataToParentPage(N,M,L);if(!$.browser.msie){workfowFlashDialog.close()}else{workfowFlashDialog.hideDialog()}}}},{text:$.i18n("workflow.designer.page.button.cancel"),handler:function(){if(!$.browser.msie){workfowFlashDialog.close()}else{workfowFlashDialog.hideDialog()}}}]})}function showWFTDiagram(D,B,H,C,E){var A=D;if(H){A=H}if(workfowFlashDialog){workfowFlashDialog.isHide=false;workfowFlashDialog.close()}C=C==undefined?"":C;E=E==undefined?"":E;var F=$(D).width();var G=$(D).height();workfowFlashDialog=$.dialog({isHide:true,url:_wfctxPath+"/workflow/designer.do?method=showDiagram&isTemplate=true&isDebugger=false&scene=2&isModalDialog=true&processId="+B+"&currentUserName="+encodeURIComponent(C)+"&currentUserAccountName="+encodeURIComponent(E),width:F-30,height:G-100,title:$.i18n("workflow.designer.title.readonly"),transParams:{dwidths:F,dheights:G,returnValueWindow:A},minParam:{show:false},maxParam:{show:false},buttons:[{text:$.i18n("workflow.designer.page.button.close"),handler:function(){if(!$.browser.msie){workfowFlashDialog.close()}else{workfowFlashDialog.hideDialog()}}}],targetWindow:D})}function showWFCDiagram(M,H,E,L,A,O,K,N,B,J,F,G,R){var C=M;if(K){C=K}if(N==null){$.alert("\u8bf7\u7ed9\u51faappName\u7684\u503c\uff01\uff08showWFCDiagram\u51fd\u6570\u7684\u7b2c\u516b\u4e2a\u53c2\u6570\uff09")}if(workfowFlashDialog){workfowFlashDialog.isHide=false;workfowFlashDialog.close()}var P=$(M).width();var I=$(M).height();var D=$.i18n("workflow.designer.title.readonly");if(G&&G!=""){D=G}var Q="";if(R&&R!=""){Q=R}workfowFlashDialog=$.dialog({isHide:true,url:_wfctxPath+"/workflow/designer.do?method=showDiagram&isDebugger=false&scene=3&isModalDialog=true&processId="+E+"&caseId="+H+"&isTemplate="+L+"&showHastenButton="+A+"&superviseId="+O+"&appName="+N+"&currentNodeId="+J+"&formMutilOprationIds="+F+"&currentUserName="+Q,width:P-30,height:I-100,title:D,transParams:{dwidths:P,dheights:I,returnValueWindow:C},minParam:{show:false},maxParam:{show:false},buttons:[{text:$.i18n("workflow.designer.page.button.close"),handler:function(){if(!$.browser.msie){workfowFlashDialog.close()}else{workfowFlashDialog.hideDialog()}if(B&&typeof B=="function"){B()}}}],targetWindow:M})}function superviousWFCDiagram(P,G,C,I,L,J,M,F,B,N){var K=wfAjax.getCaseState(G);var E=K[0]=="true"?true:false;var Q=P;if(L){Q=L}if(workfowFlashDialog){workfowFlashDialog.isHide=false;workfowFlashDialog.close()}var H=lockWorkflow(C,_wfcurrentUserId,0);var O=$(P).width();var D=$(P).height();var A=$.i18n("workflow.designer.title");if(N&&N!=""){A=N}workfowFlashDialog=$.dialog({isHide:true,url:_wfctxPath+"/workflow/designer.do?method=showDiagram&isDebugger=false&scene=3&isModalDialog=true&showHastenButton=false&processId="+C+"&caseId="+G+"&isTemplate="+I+"&appName="+J+"&flowPermAccountId="+M+"&defaultPolicyId="+F+"&defaultPolicyName="+encodeURIComponent(B),width:O-20,height:D-100,title:A,transParams:{dwidths:O,dheights:D,returnValueWindow:Q},minParam:{show:false},maxParam:{show:false},closeParam:{show:true,handler:function(){releaseWorkflow(C,_wfcurrentUserId)}},targetWindow:P,buttons:[{id:"modifyButton",text:$.i18n("workflow.designer.page.button.modify"),disabled:E,handler:function(){var R=lockWorkflow(C,_wfcurrentUserId,0);if(R[0]=="false"){$.alert(R[1]);return }else{var T=workfowFlashDialog.getReturnValue({innerButtonId:"supervious_modify"});var W=T[0];var X=T[1];var V=T[2];var U=T[3];var S=T[4];W.refreshMonitor(X,V,U,S,1,true,4);workfowFlashDialog.showBtn("okButton");workfowFlashDialog.hideBtn("modifyButton")}}},{id:"okButton",hide:true,text:$.i18n("workflow.designer.page.button.ok"),handler:function(){workfowFlashDialog.getReturnValue({innerButtonId:"supervious_ok"});if(!$.browser.msie){workfowFlashDialog.close()}else{workfowFlashDialog.hideDialog()}releaseWorkflow(C,_wfcurrentUserId)}},{text:$.i18n("workflow.designer.button.close"),handler:function(){if(!$.browser.msie){workfowFlashDialog.close()}else{workfowFlashDialog.hideDialog()}releaseWorkflow(C,_wfcurrentUserId)}}]})}function editWFCDiagramEdocModalDialog(O,L,I,M,P,N,H,R,S,C,A,J){var B=lockWorkflow(I,_wfcurrentUserId,2);if(B[0]=="false"){A=(A==undefined||A==true)?true:false;if(A){$.alert(B[1])}else{alert(B[1])}return }var T=wfAjax.getCaseState(L);var E=T[0]=="true"?true:false;var F=O;if(M){F=M}if(workfowFlashDialog){workfowFlashDialog.isHide=false;workfowFlashDialog.close()}var Q=$(O).width();var K=$(O).height();if(Q<=0){Q=$(document.body).width();K=$(document.body).height()}var G=$.i18n("workflow.designer.title");if(J&&J!=""){G=J}if(!A){var D=getA8Top().v3x.openWindow({url:_wfctxPath+"/workflow/designer.do?method=showDiagram&isDebugger=false&scene=4&isModalDialog=false&processId="+I+"&caseId="+L+"&isTemplate="+N+"&appName="+P+"&flowPermAccountId="+H+"&defaultPolicyId="+R+"&defaultPolicyName="+encodeURIComponent(S)+"&isEdoc=true&dialogTitle="+encodeURIComponent(G),width:Q-10,height:K,resizable:"no"});releaseWorkflow(I,_wfcurrentUserId);if(C&&typeof C=="function"){C()}}else{workfowFlashDialog=$.dialog({isHide:true,url:_wfctxPath+"/workflow/designer.do?method=showDiagram&isDebugger=false&scene=4&isModalDialog=true&processId="+I+"&caseId="+L+"&isTemplate="+N+"&appName="+P+"&flowPermAccountId="+H+"&defaultPolicyId="+R+"&defaultPolicyName="+encodeURIComponent(S),width:Q-20,height:K-100,title:G,transParams:{dwidths:Q,dheights:K,returnValueWindow:F},minParam:{show:false},maxParam:{show:false},closeParam:{show:true,handler:function(){releaseWorkflow(I,_wfcurrentUserId)}},targetWindow:O,buttons:[{id:"okButton",text:$.i18n("workflow.designer.page.button.ok"),disabled:E,handler:function(){workfowFlashDialog.getReturnValue({innerButtonId:"supervious_ok"});if(!$.browser.msie){workfowFlashDialog.close()}else{workfowFlashDialog.hideDialog()}releaseWorkflow(I,_wfcurrentUserId);if(C&&typeof C=="function"){C()}}},{text:$.i18n("workflow.designer.page.button.cancel"),handler:function(){if(!$.browser.msie){workfowFlashDialog.close()}else{workfowFlashDialog.hideDialog()}releaseWorkflow(I,_wfcurrentUserId)}}]})}}function editWFCDiagram(J,D,B,G,F,E,H,C,A,K,I){editWFCDiagramEdocModalDialog(J,D,B,G,F,E,H,C,A,K,true,I)}function adminWFCDiagram(O,G,B,I,M,J,Q,F,L,E,A){var K=wfAjax.getCaseState(G);var D=K[0]=="true"?true:false;var P=O;if(M){P=M}if(workfowFlashDialog){workfowFlashDialog.isHide=false;workfowFlashDialog.close()}var H=lockWorkflow(B,_wfcurrentUserId,1);var N=$(O).width();var C=$(O).height();workfowFlashDialog=$.dialog({isHide:true,url:_wfctxPath+"/workflow/designer.do?method=showDiagram&isDebugger=false&scene=3&isModalDialog=true&isst=false&processId="+B+"&caseId="+G+"&isTemplate="+I+"&appName="+J+"&flowPermAccountId="+L+"&defaultPolicyId="+E+"&defaultPolicyName="+encodeURIComponent(A),width:N-20,height:C-100,title:$.i18n("workflow.designer.title"),transParams:{dwidths:N,dheights:C,returnValueWindow:P},minParam:{show:false},maxParam:{show:false},closeParam:{show:true,handler:function(){releaseWorkflow(B,_wfcurrentUserId)}},targetWindow:O,buttons:[{id:"modifyButton",text:$.i18n("workflow.designer.page.button.modify"),disabled:D,handler:function(){var R=lockWorkflow(B,_wfcurrentUserId,1);if(R[0]=="false"){$.alert(R[1]);return }else{var T=workfowFlashDialog.getReturnValue({innerButtonId:"supervious_modify"});var W=T[0];var X=T[1];var V=T[2];var U=T[3];var S=T[4];W.refreshMonitor(X,V,U,S,1,true,5);workfowFlashDialog.showBtn("okButton");workfowFlashDialog.hideBtn("modifyButton");workfowFlashDialog.disabledBtn("repealButton");workfowFlashDialog.disabledBtn("stopButton")}}},{id:"okButton",hide:true,text:$.i18n("workflow.designer.page.button.ok"),handler:function(){workfowFlashDialog.getReturnValue({innerButtonId:"supervious_ok"});if(!$.browser.msie){workfowFlashDialog.close()}else{workfowFlashDialog.hideDialog()}releaseWorkflow(B,_wfcurrentUserId)}},{id:"repealButton",text:$.i18n("workflow.designer.page.button.repeal"),disabled:D,handler:function(){var R=canRepeal(J,B,"");if(R[0]=="false"){$.alert(R[1]);return }if(typeof Q=="function"){Q(O,G,B,I,M,J,workfowFlashDialog)}else{alert("\u9519\u8bef\uff1a\u6ca1\u6709\u627e\u5230\u65b9\u6cd5repealWorkflow(tWindow,caseId,processId,isTemplate,vWindow,appName,dialog),\u8bf7\u5b9e\u73b0!")}}},{id:"stopButton",text:$.i18n("workflow.designer.page.button.stop"),disabled:D,handler:function(){if(typeof F=="function"){F(O,G,B,I,M,J,workfowFlashDialog)}else{alert("\u9519\u8bef\uff1a\u6ca1\u6709\u627e\u5230\u65b9\u6cd5stopWorkflow(tWindow,caseId,processId,isTemplate,vWindow,appName,dialog),\u8bf7\u5b9e\u73b0!")}}},{text:$.i18n("workflow.designer.button.close"),handler:function(){if(!$.browser.msie){workfowFlashDialog.close()}else{workfowFlashDialog.hideDialog()}releaseWorkflow(B,_wfcurrentUserId)}}]})}function preSendOrHandleWorkflow(P,C,I,J,M,E,L,F,O,Q,K,N,G){if(null!=C&&C!=""&&C!="-1"){var B=wfAjax.canWorkflowCurrentNodeSubmit(C);if(null!=B&&B[0]=="false"){$.alert(B[1]);try{releaseApplicationButtons()}catch(R){}return }}if(J!=""&&C!=null&&C!="-1"&&C!="0"){var A=lockWorkflow(J,_wfcurrentUserId,14);if(A[0]=="false"){$.alert(A[1]);try{releaseApplicationButtons()}catch(R){}return }}var H=P;if(N){H=N}var D=new Object();D.appName=Q;D.processXml=K;D.processId=J;D.caseId=L;D.currentActivityId=M;D.currentWorkitemId=C;D.currentUserId=E;D.currentAccountId=F;D.formData=O;D.mastrid=O;D.debugMode=false;D.processTemplateId=I;preDoWFNew(P,D,null,H,G,J,C)}function preDoWFNew(W,E,C,L,I,R,D){var G=new Object();if(C){G=C}else{G=new Object();var J=new Array();var A=new Array();var H=new Array();G.allNotSelectNodes=J;G.allSelectNodes=A;G.allSelectInformNodes=H}G.pop=false;G.token="";var N=wfAjax.transBeforeInvokeWorkFlow(E,G)||{};var M=N.pop;var Y=N.token;if(Y&&Y=="WORKFLOW"){}else{$.alert("\u7f51\u7edc\u51fa\u73b0\u95ee\u9898\uff0c\u8bf7\u91cd\u8bd5!");return }var U=N.invalidateActivityMap||{};var B=true;var S="";$(N.allSelectNodes).each(function(Z,b){var c=U[b];var a=(c!=null&&c.trim()!="")?true:false;if(a){B=false;S+=(S!=null&&S.trim()=="")?c:"\u3001"+c}});if(!B){$.alert($.i18n("workflow.invalidateActivity.label",S));if(R!=""&&D!=null&&D!="-1"&&D!="0"){releaseWorkflowByAction(R,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(X){}return }if(M==true){var Q=N.hasSubProcess;var P="";if(Q){P=$.i18n("workflow.commonpage.branchpeoplenewflow.select")}else{P=$.i18n("workflow.commonpage.branchpeoplenewflow.select1")}var V=$.dialog({id:"workflow_dialog_showWorkFlowMatchResultPage_Id",url:_wfctxPath+"/workflow/designer.do?method=showWorkFlowMatchResultPage",width:740,height:400,title:P,isFromModle:true,targetWindow:getCtpTop(),closeParam:{show:true,handler:function(){releaseWorkflowByAction(R,_wfcurrentUserId,14);try{releaseApplicationButtons()}catch(Z){}}},transParams:{context:E,cpMatchResult:N},buttons:[{text:$.i18n("common.button.ok.label"),handler:function(){var b=$("#workflow_newflow_input",L.document)[0];if(!b){showFlashAlert('\u9519\u8bef\uff1a\u9875\u9762\u6ca1\u6709<input type="hidden" name="workflow_newflow_input" id="workflow_newflow_input"> \u7684\u9690\u85cf\u57df!');if(R!=""&&D!=null&&D!="-1"&&D!="0"){releaseWorkflowByAction(R,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(f){}return false}var a=$("#workflow_node_peoples_input",L.document)[0];if(!a){showFlashAlert('\u9519\u8bef\uff1a\u9875\u9762\u6ca1\u6709<input type="hidden" name="workflow_node_peoples_input" id="workflow_node_peoples_input"> \u7684\u9690\u85cf\u57df!');if(R!=""&&D!=null&&D!="-1"&&D!="0"){releaseWorkflowByAction(R,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(f){}return false}var d=$("#workflow_node_condition_input",L.document)[0];if(!d){showFlashAlert('\u9519\u8bef\uff1a\u9875\u9762\u6ca1\u6709<input type="hidden" name="workflow_node_condition_input" id="workflow_node_condition_input"> \u7684\u9690\u85cf\u57df!');if(R!=""&&D!=null&&D!="-1"&&D!="0"){releaseWorkflowByAction(R,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(f){}return false}var c=V.getReturnValue({innerButtonId:"ok"});if(c){$("#workflow_node_condition_input",L.document)[0].value=c[0];$("#workflow_node_peoples_input",L.document)[0].value=c[1];$("#workflow_newflow_input",L.document)[0].value=c[2];V.close();var Z=E.caseId;if(Z==null||Z.trim()==""||Z.trim()=="-1"){if(typeof I=="function"){I()}else{if($.content.callback.workflowNew){$.content.callback.workflowNew()}else{showFlashAlert("\u9519\u8bef:\u6ca1\u6709\u5b9e\u73b0\u6d41\u7a0b\u63d0\u4ea4\u65b9\u6cd5workflowNew()!");if(R!=""&&D!=null&&D!="-1"&&D!="0"){releaseWorkflowByAction(R,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(f){}return }}}else{if(Z!=null&&Z.trim()!=""&&Z.trim()!="-1"&&E.currentActivityId=="start"){if(typeof I=="function"){I()}else{if($.content.callback.workflowNew){$.content.callback.workflowNew()}else{showFlashAlert("\u9519\u8bef:\u6ca1\u6709\u5b9e\u73b0\u6d41\u7a0b\u63d0\u4ea4\u65b9\u6cd5workflowNew()!");if(R!=""&&D!=null&&D!="-1"&&D!="0"){releaseWorkflowByAction(R,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(f){}return }}}else{if(typeof I=="function"){I()}else{if($.content.callback.workflowFinish){$.content.callback.workflowFinish()}else{showFlashAlert("\u9519\u8bef:\u6ca1\u6709\u5b9e\u73b0\u6d41\u7a0b\u63d0\u4ea4\u65b9\u6cd5workflowFinish()!");if(R!=""&&D!=null&&D!="-1"&&D!="0"){releaseWorkflowByAction(R,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(f){}return }}}}}else{if(R!=""&&D!=null&&D!="-1"&&D!="0"){releaseWorkflowByAction(R,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(f){}return false}}},{text:$.i18n("common.button.cancel.label"),handler:function(){$("#workflow_newflow_input",L.document)[0].value="";$("#workflow_node_peoples_input",L.document)[0].value="";$("#workflow_node_condition_input",L.document)[0].value="";V.close();if(R!=""&&D!=null&&D!="-1"&&D!="0"){releaseWorkflowByAction(R,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(Z){}}}]})}else{var F=$("#workflow_node_condition_input",L.document)[0];if(!F){showFlashAlert('\u9519\u8bef\uff1a\u9875\u9762\u6ca1\u6709<input type="hidden" name="workflow_node_condition_input" id="workflow_node_condition_input"> \u7684\u9690\u85cf\u57df!');if(R!=""&&D!=null&&D!="-1"&&D!="0"){releaseWorkflowByAction(R,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(X){}return false}var O="";$(N.allSelectNodes).each(function(Z,a){if(Z==0){O+='{"condition":[';O+='{"nodeId":"'+a+'",';O+='"isDelete":"false"}'}else{O+=',{"nodeId":"'+a+'",';O+='"isDelete":"false"}'}});if(N.allNotSelectNodes&&N.allNotSelectNodes.length>0){var K=N.allNotSelectNodes.length-1;$(N.allNotSelectNodes).each(function(Z,a){O+=',{"nodeId":"'+a+'",';O+='"isDelete":"true"}'})}if(O!=""){O+="]}"}$("#workflow_node_condition_input",L.document)[0].value=O;var T=E.caseId;if(T==null||T.trim()==""||T.trim()=="-1"){if(typeof I=="function"){I()}else{if($.content.callback.workflowNew){$.content.callback.workflowNew()}else{showFlashAlert("\u9519\u8bef:\u6ca1\u6709\u5b9e\u73b0\u6d41\u7a0b\u63d0\u4ea4\u65b9\u6cd5workflowNew()!");if(R!=""&&D!=null&&D!="-1"&&D!="0"){releaseWorkflowByAction(R,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(X){}return }}}else{if(T!=null&&T.trim()!=""&&T.trim()!="-1"&&E.currentActivityId=="start"){if(typeof I=="function"){I()}else{if($.content.callback.workflowNew){$.content.callback.workflowNew()}else{showFlashAlert("\u9519\u8bef:\u6ca1\u6709\u5b9e\u73b0\u6d41\u7a0b\u63d0\u4ea4\u65b9\u6cd5workflowNew()!");if(R!=""&&D!=null&&D!="-1"&&D!="0"){releaseWorkflowByAction(R,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(X){}return }}}else{if(typeof I=="function"){I()}else{if($.content.callback.workflowFinish){$.content.callback.workflowFinish()}else{showFlashAlert("\u9519\u8bef:\u6ca1\u6709\u5b9e\u73b0\u6d41\u7a0b\u63d0\u4ea4\u65b9\u6cd5workflowFinish()!");if(R!=""&&D!=null&&D!="-1"&&D!="0"){releaseWorkflowByAction(R,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(X){}return }}}}}}function showFailedCondition(D,B){var C=false;var A=B==undefined?true:B;$("#workflow_select_people_or_branch tr[id='workflow_select_people_or_branch_template_ready']").each(function(J){var H=$("#workflow_branch_checkbox",$(this));var K=$("input",H).attr("checked");var F=$("input",H).attr("isSelect");var I=$("input",H).attr("defaultShow");if(K||F||I=="true"){$(this).css("display","")}else{C=true;var G=$(this).css("display");if(G=="none"){$(this).css("display","")}else{$(this).css("display","none")}}});if(C&&A){var E=$("#workflow_branch_show");if(D==0){E.html($.i18n("workflow.commonpage.branch.hide"))}else{E.html($.i18n("workflow.commonpage.branch.show"))}}}function selectPeople(A,B,E){var C=E;var F=1;var D=1;if(B=="1"){F=1}else{F=-1}$.selectPeople({type:"selectPeople",panels:"Department,Team,Post,RelatePeople",selectType:"Member",showFlowTypeRadio:false,maxSize:F,minSize:D,params:{value:""},callback:function(G){if(G.obj){A.value=G.text;A.title=G.text;$("#"+E).attr("value",getIdsString(G.obj,false))}}})}function getNamesString(E){if(!E){return""}var G=[];for(var C=0;C<E.length;C++){var F=E[C];var B=null;if(F.accountShortname){var A=document.getElementById("appName");var D=document.getElementById("orgAccountId");if(A&&A.value=="4"){if(F.type=="Account"||(D&&D.value==F.accountId)){B=F.name}else{B=F.accountShortname+F.name}}else{B=F.name+"("+F.accountShortname+")"}}else{B=F.name}G[G.length]=B}return G.join("\u3001")}function getIdsString(C,E){if(!C){return""}if(E==null){E=true}var D=[];for(var B=0;B<C.length;B++){var A=null;if(E){A=C[B].type+"|"+C[B].id}else{A=C[B].id}D[D.length]=A+(C[B].excludeChildDepartment?"|1":"")}return D.join(",")}function showSelectPeoplePart(B,A){if(B.checked){$("#node_"+A+"_peoples").css("display","")}else{$("#node_"+A+"_peoples").css("display","none")}}function showSubSelectPeoplePart(A,B){if(A.checked){$("#senderId_"+B).css("display","");$("#senderLabel_"+B).css("display","");$("#senderId_"+B+"Name").css("display","")}else{$("#senderId_"+B).css("display","none");$("#senderLabel_"+B).css("display","none");$("#senderId_"+B+"Name").css("display","none")}}function setSelectValue(B,A){$("#"+A).attr("value",B.value)}function showConditionDesc(B){var A=$("#"+B).val();A=A==""?"\u65e0\u3002":A;$("#"+B+"_a").tooltip({openAuto:true,msg:"<div class='font_size12'>"+A+"</div>"})}function insertNode(B,A,E,N,D,L,M,C,K,P,J,G,F){var O=wfAjax.canChangeNode(B);if(O[0]=="false"){$.alert(O[1]);return }var H=lockWorkflow(A,_wfcurrentUserId,3);if(H[0]=="false"){$.alert(H[1]);return }if(!F){F=false}var I=$.dialog({url:_wfctxPath+"/workflow/process.do?method=preAddNodeToDiagram&appName="+L+"&isForm="+M+"&defaultPolicyId="+C+"&accountId="+K+"&processId="+A+"&nodeId="+E+"&caseId="+D+"&isTemplete="+F,transParams:{processId:A,nodeId:E,processXML:$("#process_xml").val()},width:420,height:230,title:$.i18n("workflow.insertPeople.title"),buttons:[{text:$.i18n("common.button.ok.label"),handler:function(){try{var X=I.getReturnValue();if(X!=null&&X.length>0){var Q=$.parseJSON(X);var S=$("#process_xml");if(S.size()<=0){$.alert("\u8bf7\u6dfb\u52a0id=process_xml\u7684\u9690\u85cf\u57df\uff01");return }var T=S.val();var V="";var R=$("#process_message_data");if(R.size()>0){V=R.val()}Q.summaryId=J;Q.affairId=G;var Y=wfAjax.addNode(A,E,E,N,1,Q,T,"",V);if("false"==Y[2]){$.alert(Y[3]);return }if(Y&&Y[0]){S.val(Y[0])}if(Y&&Y[4]&&R.size()>0){R.val(Y[4]);R=null}S=null;var W={type:1,currentNodeId:E,names:Q.userName,messageDataList:Y[4]};if(typeof P=="function"){P(W)}else{if(typeof refreshWorkflow=="function"){refreshWorkflow(W)}else{$.alert("\u8bf7\u6dfb\u52a0\u4e00\u4e2a\u540d\u5b57\u4e3arefreshWorkflow\u7684\u51fd\u6570\uff0c\u4ee5\u5237\u65b0\u6d41\u7a0b\u56fe\u9875\u9762\uff0c\u770b\u5230\u52a0\u7b7e/\u51cf\u7b7e\u6548\u679c\uff01")}}I.close()}else{$.alert($.i18n("workflow.least.select.one"));return }}catch(U){showFlashAlert(U.message)}}},{text:$.i18n("common.button.cancel.label"),handler:function(){I.close()}}],targetWindow:getCtpTop()})}function assignNode(B,A,E,M,D,K,L,C,J,O,I,F){var N=wfAjax.canChangeNode(B);if(N[0]=="false"){$.alert(N[1]);return }var G=lockWorkflow(A,_wfcurrentUserId,5);if(G[0]=="false"){$.alert(G[1]);return }var H=$.dialog({url:_wfctxPath+"/workflow/process.do?method=preAssignNode&appName="+K+"&isForm="+L+"&defaultPolicyId="+C+"&accountId="+J+"&nodeId="+E,transParams:{processId:A,nodeId:E,processXML:$("#process_xml").val()},width:400,height:190,title:$.i18n("workflow.assignNode.assign"),buttons:[{text:$.i18n("common.button.ok.label"),handler:function(){try{var Y=H.getReturnValue();if(Y!=null&&Y.length>0){var P=$.parseJSON(Y);var S=$("#process_xml");var R=$("#readyObjectJSON");if(S.size()<=0){$.alert("\u8bf7\u6dfb\u52a0id=process_xml\u7684\u9690\u85cf\u57df\uff01");return }if(R.size()<=0){$.alert("\u8bf7\u6dfb\u52a0id=readyObjectJSON\u7684\u9690\u85cf\u57df\uff01");return }var T=S.val();var X=R.val();var V="";var Q=$("#process_message_data");if(Q.size()>0){V=Q.val()}P.summaryId=I;P.affairId=F;var Z=wfAjax.addNode(A,E,E,M,3,P,T,X,V);if(Z&&Z[0]){S.val(Z[0])}if(Z&&Z[1]){R.val(Z[1])}if(Z&&Z[4]&&Q.size()>0){Q.val(Z[4]);Q=null}S=null;R=null;var W={type:3,currentNodeId:E,names:P.userName,messageDataList:Z[4]};if(typeof O=="function"){O(W)}else{if(typeof refreshWorkflow=="function"){refreshWorkflow(W)}else{$.alert("\u8bf7\u6dfb\u52a0\u4e00\u4e2a\u540d\u5b57\u4e3arefreshWorkflow\u7684\u51fd\u6570\uff0c\u4ee5\u5237\u65b0\u6d41\u7a0b\u56fe\u9875\u9762\uff0c\u770b\u5230\u52a0\u7b7e/\u51cf\u7b7e\u6548\u679c\uff01")}}H.close()}else{$.alert($.i18n("workflow.least.select.one"));return }}catch(U){showFlashAlert(U.message)}}},{text:$.i18n("common.button.cancel.label"),handler:function(){H.close()}}],targetWindow:getCtpTop()})}function informNode(D,A,G,O,F,M,N,E,L,Q,K,H){var P=wfAjax.canChangeNode(D);if(P[0]=="false"){$.alert(P[1]);return }var I=lockWorkflow(A,_wfcurrentUserId,6);if(I[0]=="false"){$.alert(I[1]);return }var J=wfAjax.getAcountExcludeElements();var C=parseElements(J[0]);var B={type:"selectPeople",text:$.i18n("workflow.insertPeople.urgerAlt"),showFlowTypeRadio:false,isConfirmExcludeSubDepartment:true,unallowedSelectEmptyGroup:true,excludeElements:C,params:{value:""},targetWindow:getCtpTop(),callback:function(j){if(j&&j.obj&&j.obj.length>0){var Z=[],T=[],h=[],S=[],W=[],U=[],c=[];var g={};for(var d=0,e=j.obj.length;d<e;d++){Z.push(j.obj[d].id);T.push(j.obj[d].name);h.push(j.obj[d].type);S.push(j.obj[d].excludeChildDepartment);W.push(j.obj[d].accountId);U.push(j.obj[d].accountShortname);c.push("all")}g.userId=Z;g.userName=T;g.userType=h;g.userExcludeChildDepartment=S;g.accountId=W;g.accountShortname=U;g.flowType="5";g.node_process_mode=c;g.policyId=E;g.policyName="\u77e5\u4f1a";if(N){g.formOperationPolicy="0"}else{g.formOperationPolicy="1"}var b=$("#process_xml"),R=$("#readyObjectJSON");if(b.size()<=0){$.alert("\u8bf7\u6dfb\u52a0id=process_xml\u7684\u9690\u85cf\u57df\uff01");return }var f=b.val();var V=$("#process_message_data");var Y="";if(V.size()>0){Y=V.val()}g.summaryId=K;g.affairId=H;var X=wfAjax.addNode(A,G,G,O,2,g,f,"",Y);if(X&&X[0]){b.val(X[0])}if(X&&X[4]&&V.size()>0){V.val(X[4]);V=null}b=null;var a={type:2,currentNodeId:G,names:g.userName,messageDataList:X[4]};if(typeof Q=="function"){Q(a)}else{if(typeof refreshWorkflow=="function"){refreshWorkflow(a)}else{$.alert("\u8bf7\u6dfb\u52a0\u4e00\u4e2a\u540d\u5b57\u4e3arefreshWorkflow\u7684\u51fd\u6570\uff0c\u4ee5\u5237\u65b0\u6d41\u7a0b\u56fe\u9875\u9762\uff0c\u770b\u5230\u52a0\u7b7e/\u51cf\u7b7e\u6548\u679c\uff01")}}}else{$("#collSelectPeopleInput").val("<"+$.i18n("workflow.insertPeople.urgerAlt")+">")}}};if(M=="collaboration"||M=="form"){B.panels="Department,Team,Post,Outworker,RelatePeople";B.selectType="Account,Member,Department,Team,Post,Outworker,RelatePeople"}else{B.panels="Department,Team,Post";B.selectType="Account,Member,Department,Team,Post"}$.selectPeople(B)}function deleteNode(B,A,D,I,C,K,H,E){var J=wfAjax.canChangeNode(B);if(J[0]=="false"){$.alert(J[1]);return }var F=lockWorkflow(A,_wfcurrentUserId,4);if(F[0]=="false"){$.alert(F[1]);return }var G=$.dialog({id:"workflow_dialog_prePreDeleteNodeFromDiagram",isFromModle:true,url:_wfctxPath+"/workflow/process.do?method=prePreDeleteNodeFromDiagram",transParams:{processId:A,nodeId:D,processXML:$("#process_xml").val()},width:400,height:280,title:$.i18n("workflow.deletePeople.title"),buttons:[{text:$.i18n("common.button.ok.label"),handler:function(){try{var N=G.getReturnValue();if(N!=null&&N.length>0){var O=$.parseJSON(N);var M=O.idArray;if(M.length<=0){$.alert($.i18n("workflow.least.select.one"));return }var P=$("#process_xml");var L=$("#process_message_data");var S="";if(L.size()>0){S=L.val()}var Q=P.val();var U=wfAjax.deleteNode(A,D,I,M,Q,S,H,E);if(U&&U.processXML){P.val(U.processXML);if(L.size()>0){L.val(U.messageDataList);L=null}}P=null;var T={type:4,currentNodeId:D,names:O.nameArray,messageDataList:U.messageDataList};if(typeof K=="function"){K(T)}else{if(typeof refreshWorkflow=="function"){refreshWorkflow(T)}else{$.alert("\u8bf7\u6dfb\u52a0\u4e00\u4e2a\u540d\u5b57\u4e3arefreshWorkflow\u7684\u51fd\u6570\uff0c\u4ee5\u5237\u65b0\u6d41\u7a0b\u56fe\u9875\u9762\uff0c\u770b\u5230\u52a0\u7b7e/\u51cf\u7b7e\u6548\u679c\uff01")}}}}catch(R){showFlashAlert(R.message)}G.close()}},{text:$.i18n("common.button.cancel.label"),handler:function(){G.close()}}],targetWindow:getCtpTop()})}function getUUID(){var A=new Date().getTime()+""+(UUID_seqence++);if(UUID_seqence>=100000){UUID_seqence=0}return A}function createProcessXml(N,M,L,B,U,D,O,H,P,E,C,J,A,T){var F=M;if(L){F=L}A=A==undefined?"":A;var I="Department,Team,Post,Outworker,RelatePeople";var Q="Member,Account,Department,Team,Post,Outworker,RelatePeople";if(E!=undefined&&E!=null){I=E}if(C!=undefined&&C!=null){Q=C}var S=wfAjax.getAcountExcludeElements();var K=parseElements(S[0]);var G="sequence";if(N=="edocSend"||N=="signReport"||N=="recEdoc"){G="sequence"}else{G="concurrent"}J=J==undefined?true:J;var R=$.selectPeople({type:"selectPeople",panels:I,selectType:Q,text:$.i18n("workflow.insertPeople.urgerAlt"),showFlowTypeRadio:true,hiddenColAssignRadio:true,hiddenMultipleRadio:!J,flowtype:G,mode:A,targetWindow:M,isConfirmExcludeSubDepartment:true,unallowedSelectEmptyGroup:true,excludeElements:K,params:{value:T==undefined?"":T},callback:function(V){try{var W=$("#process_info_selectvalue",F.document);var Y=$("#process_info_selectvalue",M.document);W.val(V.value);Y.val(V.value)}catch(X){}createProcessXmlCallBack(M,V,N,F,B,U,D,O,H,P)}})}function createProcessXmlForward(F,H,G,B,D){var I="";try{var C=$("#process_info_selectvalue",G.document);var A=$("#process_info_selectvalue",H.document);if(C[0]){I=C.val()}else{I=A.val()}}catch(E){}createProcessXml(F,H,G,"-1","","","","-1","",null,null,B,D,I)}function createProcessXmlCallBack(Z,g,X,k,c,a,j,q,b,d){if(g&&g.obj&&g.obj.length>0&&g.obj[0].length>0){var h=[],V=g.obj[2],m="collaboration",Q=$.i18n("workflow.createProcessXml.collaboration"),x="0",p=g.obj[1],u="all",K="",W="",H="",B="",T="",J="",A="";if(X=="sendEdoc"||X=="signReport"||X=="edocSend"){Q=d;m="shenpi"}else{if(X=="recEdoc"){Q=d;m="yuedu"}else{if(X=="sendInfo"){m="shenhe";Q=d}}}h.push("<processes>");h.push('<process isShowShortName="'+V+'" index="0" sortIndex="0" flowType="workflow" y="0" x="0" type="Node" desc="" name="" id="">');h.push('<node sortIndex="0" y="" x="" type="8" desc="" name="" id="start">');h.push('<actor accountShortName="" accountId="" condition="1" partyIdName="" partyTypeName="" partyId="" partyType="" includeChild="false" const="false" role=""/>');h.push('<seeyonPolicy matchScope="1" operationName="" form="" formApp="" isOvertopTime="0" processMode="multiple" remindTime="" dealTerm="" isDelete="false" isPass="success" desc="" type="" name="" id="collaboration"/>');h.push("</node>");h.push('<node sortIndex="0" y="430" x="720" type="4" desc="" name="end" id="end">');h.push('<actor accountShortName="" accountId="" condition="1" partyIdName="" partyTypeName="" partyId="" partyType="" includeChild="false" const="false" role=""/>');h.push('<seeyonPolicy matchScope="1" operationName="" form="" formApp="" isOvertopTime="0" processMode="multiple" remindTime="" dealTerm="" isDelete="false" isPass="success" desc="" type="" name="'+$.i18n("workflow.createProcessXml.collaboration")+'" id="collaboration"/>');h.push("</node>");var M=[],O=g.obj[0];for(var s=0,N=O.length;s<N;s++){var I=O[s];var r=getUUID(),K=I.id,W=I.name,H=I.type,B=I.excludeChildDepartment,T=I.accountId,E=I.accountShortname||"";M.push(r);if(H=="Member"){H="user"}var R=1;if(H=="Post"&&T=="-1730833917365171641"){R=2}h.push('<node task_num_value="1" personStatus="normal" task_num="false" finishNum2="1000" finishNum="0" type="6" desc="" name="'+escapeSpecialChar(W)+'" id="'+r+'">');h.push('<actor accountShortName="'+escapeSpecialChar(E)+'" accountId="'+T+'" condition="1" partyIdName="'+escapeSpecialChar(W)+'" partyTypeName="" partyId="'+K+'" partyExcludeChildDepartment="'+B+'" partyType="'+H+'" includeChild="false" const="false" role="roleadmin"/>');h.push('<seeyonPolicy matchScope="'+R+'" operationName="" form="" formApp="" isOvertopTime="0" processMode="all" remindTime="" dealTerm="" isDelete="false" isPass="success" desc="" type="" name="'+Q+'" id="'+m+'"/>');h.push("</node>");if(s<12){if(s>0){A+=$.i18n("workflow.createProcessXml.common_separator_label")}var Y=W+"("+Q+")";if(E!=null&&E!="null"&&E!="undefined"&&E!=""){Y="("+E+")"+Y}A+=Y}}if(p==0||M.length==1){h.push('<link conditionBase="" isForce="" conditionId="" formCondition="" conditionType="3" sortIndex="0" to="'+M[0]+'" from="start" type="11" desc="" name="" id="'+getUUID()+'"/>');h.push('<link conditionBase="" isForce="" conditionId="" formCondition="" conditionType="3" sortIndex="0" to="end" from="'+M[M.length-1]+'" type="11" desc="" name="" id="'+getUUID()+'"/>');for(var s=0;s<M.length-1;s++){var v=M[s];var l=M[s+1];h.push('<link conditionBase="" isForce="" conditionId="" formCondition="" conditionType="3" sortIndex="0" to="'+l+'" from="'+v+'" type="11" desc="" name="" id="'+getUUID()+'"/>')}}else{var L=getUUID();var o=getUUID();h.push('<node parallelismNodeId="" start="true" y="430" x="240" type="2" desc="" name="split" id="'+L+'">');h.push('    <seeyonPolicy matchScope="1" operationName="" form="" formApp="" isOvertopTime="0" processMode="all" remindTime="" dealTerm="" isDelete="false" isPass="success" desc="" type="" name="'+Q+'" id="'+m+'"/>');h.push("</node>");h.push('<node parallelismNodeId="" start="false" y="430" x="560" type="2" desc="" name="join" id="'+o+'">');h.push('    <seeyonPolicy matchScope="1" operationName="" form="" formApp="" isOvertopTime="0" processMode="all" remindTime="" dealTerm="" isDelete="false" isPass="success" desc="" type="" name="'+Q+'" id="'+m+'"/>');h.push("</node>");h.push('<link conditionBase="" isForce="" conditionId="" formCondition="" conditionType="3" sortIndex="0" to="'+L+'" from="start" type="11" desc="" name="" id="'+getUUID()+'"/>');h.push('<link conditionBase="" isForce="" conditionId="" formCondition="" conditionType="3" sortIndex="0" to="end" from="'+o+'" type="11" desc="" name="" id="'+getUUID()+'"/>');for(var s=M.length-1;s>=0;s--){var P=M[s];h.push('<link conditionBase="" isForce="" conditionId="" formCondition="" conditionType="3" sortIndex="0" to="'+P+'" from="'+L+'" type="11" desc="" name="" id="'+getUUID()+'"/>');h.push('<link conditionBase="" isForce="" conditionId="" formCondition="" conditionType="3" sortIndex="0" to="'+o+'" from="'+P+'" type="11" desc="" name="" id="'+getUUID()+'"/>')}}h.push("</process></processes>");var G=h.join("");var F=$("#process_xml",k.document);if(F.size()<=0){$.alert("\u8bf7\u6dfb\u52a0id=process_xml\u7684\u8f93\u5165\u57df\uff01")}F.val(G);var D=$("#process_desc_by",k.document);if(D.size()<=0){$.alert("\u8bf7\u6dfb\u52a0id=process_desc_by\u7684\u8f93\u5165\u57df\uff01")}D.val("xml");var C=$("#process_info",k.document);if(C.size()<=0){$.alert("\u8bf7\u6dfb\u52a0id=process_info\u7684\u8f93\u5165\u57df\uff01")}C.val(A);F=D=C=null;try{var U=$("#process_desc_by",Z.document)[0];var S=$("#process_xml",Z.document)[0];var n=$("#process_info",Z.document)[0];U.value="xml";S.value=G;n.value=A}catch(w){}if(p==2){createWFPersonal(Z,X,c,a,j,"-1",k,q,b,d)}}}function showFlashAlert(A){try{var C=$.alert(A)}catch(B){C(A)}}function stepBackToTargetNode(O,L,B,H,J,K,R,D,E,F,C,M){var N=wfAjax.canSpecialStepBack(B);if(N[0]=="false"){$.alert(N[1]);try{releaseApplicationButtons()}catch(P){}return }var A=lockWorkflow(H,_wfcurrentUserId,10);if(A[0]=="false"){$.alert(A[1]);try{releaseApplicationButtons()}catch(P){}return false}E=E==undefined?true:E;D=D==undefined?true:D;F=F==undefined?"":F;C=C==undefined?"":C;var G=O;if(L){G=L}if(workfowFlashDialog){workfowFlashDialog.isHide=false;workfowFlashDialog.close()}var Q=$(O).width();var I=$(O).height()-50;try{workfowFlashDialog=$.dialog({isHide:true,url:_wfctxPath+"/workflow/designer.do?method=showDiagram&isDebugger=false&scene=6&isModalDialog=true&processId="+H+"&caseId="+J+"&currentNodeId="+K+"&showToMe="+E+"&showReGo="+D+"&permissionAccountId="+F+"&configCategory="+C+"&isTemplate="+M,width:Q-300,height:I-100,title:$.i18n("workflow.special.stepback.title"),transParams:{dwidths:Q-270,dheights:I-110,returnValueWindow:G},minParam:{show:false},maxParam:{show:false},closeParam:{show:true,handler:function(){releaseWorkflowByAction(H,_wfcurrentUserId,10);try{releaseApplicationButtons()}catch(S){}}},targetWindow:O,buttons:[{text:$.i18n("workflow.designer.page.button.ok"),handler:function(){var V=workfowFlashDialog.getReturnValue({innerButtonId:"stepback_ok"});var T=V[0];if(T){var S=V[1];var W=V[2];if(S=="start"&&W=="0"){var U=$.confirm({msg:$.i18n("workflow.special.stepback.label8"),ok_fn:function(){R(B,H,J,K,V[1],V[2],workfowFlashDialog,V[3])},cancel_fn:function(){}})}else{R(B,H,J,K,V[1],V[2],workfowFlashDialog,V[3])}}else{showFlashAlert($.i18n("workflow.special.stepback.label9"))}}},{text:$.i18n("workflow.designer.page.button.cancel"),handler:function(){if(!$.browser.msie){workfowFlashDialog.close()}else{workfowFlashDialog.hideDialog()}releaseWorkflowByAction(H,_wfcurrentUserId,10);try{releaseApplicationButtons()}catch(S){}return false}}]})}catch(P){alert(P)}}function multistageSign(S,C,Q,K,E,O,L,I,V,F,M,H,R,B,J){var P=wfAjax.canChangeNode(E);if(P[0]=="false"){$.alert(P[1]);return }var D=lockWorkflow(O,_wfcurrentUserId,8);if(D[0]=="false"){$.alert(D[1]);return }var N=H==undefined?"Department":H;var T=R==undefined?"Department,Member":R;var B=B;var G=-1;var A=1;var U=$.selectPeople({type:"selectPeople",panels:N,selectType:T,text:$.i18n("workflow.insertPeople.urgerAlt"),showFlowTypeRadio:false,targetWindow:getCtpTop(),departmentId:B+"",unallowedSelectEmptyGroup:true,params:{value:""},callback:function(W){showMultistageSignPageCallBack(W,J,C,Q,K,E,O,L,I,V,F,M,S)}})}function escapeSpecialChar(A){if(!A){return A}A=A.replace(/\&/g,"&amp;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\"/g,"&quot;");A=A.replace(/\'/g,"&#039;").replace(/"/g,"&#034;");return A}function showMultistageSignPageCallBack(K,O,L,G,B,D,A,E,C,H,F,M,J){var N=K.value;var I=$.dialog({url:_wfctxPath+"/workflow/process.do?method=preAddMoreSign&appName="+J+"&flowPermAccountId="+M+"&selObj="+N+"&nodeId="+E,width:500,height:350,title:$.i18n("workflow.moreSign.findPerson"),minParam:{show:false},maxParam:{show:false},targetWindow:getCtpTop(),buttons:[{text:$.i18n("workflow.designer.page.button.ok"),handler:function(){var U=I.getReturnValue();if(U==false){}else{if(U!=null&&U.length>0){var T=$.parseJSON(U);var S=$("#process_xml");if(S.size()<=0){$.alert("\u8bf7\u6dfb\u52a0id=process_xml\u7684\u9690\u85cf\u57df\uff01");return }var V=S.val();var W="";var Q=$("#process_message_data");if(Q.size()>0){W=Q.val()}T.summaryId=L;T.affairId=G;T.currentUserId=C;T.performer=B;T.workitemId=D;T.currentLoginAccountId=F;var P=wfAjax.addNode(A,E,E,B,5,T,V,"",W);if("false"==P[2]){$.alert(P[3]);return }if(P&&P[0]){S.val(P[0])}if(P&&P[4]&&Q.size()>0){Q.val(P[4]);Q=null}S=null;var R={messageDataList:P[4]};if(typeof O=="function"){O(R)}else{if(typeof refreshWorkflow=="function"){refreshWorkflow(R)}else{$.alert("\u8bf7\u6dfb\u52a0\u4e00\u4e2a\u540d\u5b57\u4e3arefreshWorkflow\u7684\u51fd\u6570\uff0c\u4ee5\u5237\u65b0\u6d41\u7a0b\u56fe\u9875\u9762\uff0c\u770b\u5230\u52a0\u7b7e/\u51cf\u7b7e\u6548\u679c\uff01")}}I.close()}}}},{text:$.i18n("workflow.designer.page.button.cancel"),handler:function(){I.close()}}]})}function passRead(D,A,E,L,J,I,K,F,O,N){var M=wfAjax.canChangeNode(D);if(M[0]=="false"){$.alert(M[1]);return }var G=lockWorkflow(A,_wfcurrentUserId,7);if(G[0]=="false"){$.alert(G[1]);return }var H=wfAjax.getAcountExcludeElements();var C=parseElements(H[0]);var B={type:"selectPeople",text:$.i18n("workflow.insertPeople.urgerAlt"),showFlowTypeRadio:false,isConfirmExcludeSubDepartment:true,excludeElements:C,params:{value:""},departmentId:O+"",unallowedSelectEmptyGroup:true,targetWindow:getCtpTop(),callback:function(g){if(g&&g.obj&&g.obj.length>0){var X=[],R=[],f=[],Q=[],U=[],S=[],a=[];var e={};for(var b=0,c=g.obj.length;b<c;b++){X.push(g.obj[b].id);R.push(g.obj[b].name);f.push(g.obj[b].type);Q.push(g.obj[b].excludeChildDepartment);U.push(g.obj[b].accountId);S.push(g.obj[b].accountShortname);a.push("all")}e.userId=X;e.userName=R;e.userType=f;e.userExcludeChildDepartment=Q;e.accountId=U;e.accountShortname=S;e.node_process_mode=a;var Z=$("#process_xml"),P=$("#readyObjectJSON");if(Z.size()<=0){$.alert("\u8bf7\u6dfb\u52a0id=process_xml\u7684\u9690\u85cf\u57df\uff01");return }var d=Z.val();var T=$("#process_message_data");var W="";if(T.size()>0){W=T.val()}e.summaryId=K;e.affairId=F;var V=wfAjax.addNode(A,E,E,L,6,e,d,"",W);if(V&&V[0]){Z.val(V[0])}if(V&&V[4]&&T.size()>0){T.val(V[4]);T=null}Z=null;var Y={messageDataList:V[4]};if(typeof N=="function"){N(Y)}else{if(typeof refreshWorkflow=="function"){refreshWorkflow(Y)}else{$.alert("\u8bf7\u6dfb\u52a0\u4e00\u4e2a\u540d\u5b57\u4e3arefreshWorkflow\u7684\u51fd\u6570\uff0c\u4ee5\u5237\u65b0\u6d41\u7a0b\u56fe\u9875\u9762\uff0c\u770b\u5230\u52a0\u7b7e/\u51cf\u7b7e\u6548\u679c\uff01")}}}else{$("#collSelectPeopleInput").val("<"+$.i18n("workflow.insertPeople.urgerAlt")+">")}}};B.panels="Department,Team";B.selectType="Account,Department,Team,Member";$.selectPeople(B)};